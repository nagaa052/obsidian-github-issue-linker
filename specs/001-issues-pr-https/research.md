# Phase 0: Research

## 1. GitHub CLI (`gh`) コメント取得機能

### 決定: GitHub REST API v3 経由でコメント取得
- **理由**: `gh api` コマンドでREST APIエンドポイントを直接呼び出し可能
- **エンドポイント**: 
  - Issues: `/repos/{owner}/{repo}/issues/comments/{comment_id}`
  - Pull Requests: 同じエンドポイント（GitHubはPRコメントもissueコメントとして扱う）
- **代替案検討**: 
  - GraphQL API - より複雑で今回のユースケースには不要
  - 直接API呼び出し - 認証の管理が必要になり、既存の`gh`コマンド活用より複雑

## 2. コメントURL形式の解析方法

### 決定: 正規表現パターンでコメントIDを抽出
- **理由**: 既存のIssue/PR URLパターンと一貫性を保つ
- **パターン**: 
  - Issues: `https://github.com/{owner}/{repo}/issues/{number}#issuecomment-{comment_id}`
  - PRs: `https://github.com/{owner}/{repo}/pull/{number}#issuecomment-{comment_id}`
  - Discussion: `https://github.com/{owner}/{repo}/pull/{number}#discussion_r{comment_id}`
- **代替案検討**: URLパーサーライブラリ - オーバーエンジニアリング

## 3. キャッシュ戦略

### 決定: 既存のキャッシュメカニズムを活用
- **理由**: 既存のGitHubServiceクラスにTTLベースのキャッシュ実装済み
- **実装**: Map<url, {title, body, author, timestamp}>
- **TTL**: 既存設定を踏襲（デフォルト60分）
- **代替案検討**: 永続的キャッシュ - オフライン要件が未確定のため保留

## 4. 表示形式

### 決定: インラインプレビューで実装
- **理由**: 既存のIssue/PRリンク表示と一貫性を保つ
- **形式**: `[#{number} (comment)](url) - {comment preview...}`
- **プレビュー長**: 最初の100文字程度で切り詰め
- **代替案検討**: 
  - モーダル表示 - Obsidianプラグインとして複雑
  - サイドバー表示 - UIの大幅変更が必要

## 5. エラーハンドリング

### 決定: 既存のGitHubErrorクラスを拡張
- **理由**: 一貫したエラー処理パターン
- **ケース**:
  - 削除されたコメント: 404エラー → フォールバック表示
  - APIレート制限: 403エラー → エラーメッセージ表示
  - ネットワークエラー: タイムアウト → リトライなし、エラー通知
- **代替案検討**: カスタムエラークラス階層 - 現時点では不要

## 6. プライベートリポジトリサポート

### 決定: `gh`コマンドの既存認証を活用
- **理由**: ユーザーが既に`gh auth login`で認証済みの前提
- **実装**: 追加認証処理は不要、`gh api`が自動的に認証トークンを使用
- **代替案検討**: 個別トークン管理 - ユーザビリティ低下

## 7. パフォーマンス最適化

### 決定: 非同期処理とバッチ処理は実装しない
- **理由**: 
  - 単一URLの処理がメインユースケース
  - 既存実装もシンプルな同期処理
  - Obsidianのエディタイベントは逐次的
- **代替案検討**: Promise.all()でのバッチ処理 - 複雑さに見合わない

## まとめ

全ての技術的不確定要素を解決しました：
- GitHub CLIの`gh api`コマンドでコメント取得
- 既存のキャッシュ・エラー処理機構を活用
- インラインプレビュー形式で表示
- 既存の認証フローをそのまま利用

次のPhase 1では、これらの決定事項に基づいて詳細設計を行います。