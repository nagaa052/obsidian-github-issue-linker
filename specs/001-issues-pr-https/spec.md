# 機能仕様書: GitHubコメントリンクサポート

**機能ブランチ**: `001-issues-pr-https`  
**作成日**: 2025-09-05  
**ステータス**: ドラフト  
**入力**: ユーザーの説明: "issuesやPRのコメントのリンクが貼られたときもその内容を取得し表示したい

例：https://github.com/abema/dp/issues/2336#issuecomment-3243595867"

## 実行フロー (main)
```
1. 入力からユーザーの説明を解析
   → ✓ 機能の説明が提供されている
2. 説明から主要な概念を抽出
   → 特定: GitHubコメントリンク、コンテンツ取得、Obsidianでの表示
3. 不明確な各側面について:
   → [要確認: コメントの表示形式 - インラインプレビュー、モーダル、サイドバー？]
   → [要確認: 古いコメントをオフラインアクセスのためにキャッシュすべきか？]
   → [要確認: プライベートリポジトリの認証要件は？]
4. ユーザーシナリオとテストセクションを記入
   → ✓ ユーザーフローを特定
5. 機能要件を生成
   → ✓ すべての要件がテスト可能
6. 主要エンティティを特定
   → コメントデータ構造を特定
7. レビューチェックリストを実行
   → 警告 "仕様には表示形式とキャッシングに関する不確実性があります"
8. 戻り値: SUCCESS (明確化が必要だが仕様は計画準備完了)
```

---

## ⚡ クイックガイドライン
- ✅ ユーザーが何を必要とし、なぜ必要なのかに焦点を当てる
- ❌ どのように実装するかは避ける（技術スタック、API、コード構造なし）
- 👥 開発者ではなく、ビジネス関係者向けに書く

### セクション要件
- **必須セクション**: すべての機能で完成させる必要がある
- **オプションセクション**: 機能に関連する場合のみ含める
- セクションが適用されない場合は、完全に削除する（「N/A」のままにしない）

---

## ユーザーシナリオとテスト *(必須)*

### 主要ユーザーストーリー
GitHubリポジトリを扱うObsidianユーザーとして、GitHub IssueやPull Requestの特定のコメントへの直接リンク（例：https://github.com/owner/repo/issues/123#issuecomment-456789）を貼り付けて、現在の通常のIssue/PRリンクと同様に、コメントの内容が自動的に取得されノート内に表示されることを望みます。

### 受け入れシナリオ
1. **前提条件** ユーザーが有効なGitHubコメントリンクを持っている、**実行** Obsidianノートに貼り付ける、**期待結果** プラグインがコメントリンクを検出し、コメント内容を取得して表示する
2. **前提条件** コメントリンクが検出された、**実行** プラグインがコメントデータを取得する、**期待結果** コメント作成者、タイムスタンプ、内容をフォーマットされたプレビューで表示する
3. **前提条件** ユーザーが複数のコメントリンクを貼り付けた、**実行** プラグインがそれらを処理する、**期待結果** 各コメントが独立して取得され表示される
4. **前提条件** コメントリンクがプライベートリポジトリを指している、**実行** プラグインが取得を試みる、**期待結果** [要確認: 認証を処理するか適切なエラーメッセージを表示するか？]

### エッジケース
- コメントが削除されている場合はどうなるか？
- 埋め込み画像やコードブロックを含むコメントをどのように処理するか？
- GitHub APIのレート制限に達した場合はどうなるか？
- 不正な形式のコメントURLをどのように処理するか？
- 取得中にネットワーク接続が失われた場合はどうなるか？

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムは `https://github.com/{owner}/{repo}/issues/{number}#issuecomment-{id}` 形式のGitHubコメントURLを認識しなければならない
- **FR-002**: システムは `https://github.com/{owner}/{repo}/pull/{number}#issuecomment-{id}` 形式のGitHubコメントURLを認識しなければならない
- **FR-003**: システムは作成者のユーザー名、作成タイムスタンプ、コメント本文を含むコメントメタデータを取得しなければならない
- **FR-004**: システムは取得したコメント内容を[要確認: インラインプレビュー、モーダル、または設定可能な表示形式？]で表示しなければならない
- **FR-005**: システムはネットワークエラーを適切に処理し、ユーザーフレンドリーなエラーメッセージを表示しなければならない
- **FR-006**: システムはGitHub APIレート制限を尊重し、制限に達した場合はユーザーに通知しなければならない
- **FR-007**: パブリックリポジトリからのコメントは認証なしでアクセス可能でなければならない
- **FR-008**: システムは[要確認: 取得したコメントをオフラインアクセスのためにキャッシュするか、常に最新データを取得するか？]
- **FR-009**: システムはマークダウン、コードブロック、リストを含むコメント内容の元の書式を保持しなければならない
- **FR-010**: システムはコメントデータ取得中にローディングインジケーターを表示しなければならない

### 主要エンティティ *(データが関係する場合に含める)*
- **GitHubコメント**: Issue またはPull Request上の単一のコメントを表し、作成者情報、タイムスタンプ、本文内容、関連するIssue/PR参照を含む
- **コメントリンク**: 特定のコメントを指すURL、リポジトリ所有者、名前、Issue/PR番号、コメントIDを含む
- **コメントプレビュー**: Obsidian内で取得されたコメントの視覚的表現、フォーマットされた内容とメタデータを表示

---

## レビューと受け入れチェックリスト
*GATE: main()実行中に実行される自動チェック*

### コンテンツ品質
- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点を当てている
- [x] 非技術的な関係者向けに書かれている
- [x] すべての必須セクションが完成している

### 要件の完全性
- [ ] [要確認]マーカーが残っていない
- [x] 要件がテスト可能で明確である
- [x] 成功基準が測定可能である
- [x] 範囲が明確に定められている
- [ ] 依存関係と前提条件が特定されている

---

## 実行ステータス
*処理中にmain()によって更新*

- [x] ユーザーの説明を解析済み
- [x] 主要概念を抽出済み
- [x] 曖昧さをマーク済み
- [x] ユーザーシナリオを定義済み
- [x] 要件を生成済み
- [x] エンティティを特定済み
- [ ] レビューチェックリストをパス

---